select nation, o_year, sum(amount)::float as sum_profit from (select n_name as nation, date_part('year', o_orderdate)::text as o_year, ((l_extendedprice * (1 - l_discount))::float - (ps_supplycost * l_quantity)::float)::float as amount from ((select p_partkey from part where p_name like '%green%') part join (select l_extendedprice, l_discount, l_quantity, l_suppkey, l_partkey, l_orderkey from lineitem) lineitem on (l_partkey = p_partkey) join (select s_nationkey, s_suppkey from supplier) supplier on (s_suppkey = l_suppkey) join (select ps_supplycost, ps_partkey, ps_suppkey from partsupp) partsupp on (ps_partkey = l_partkey and ps_suppkey = l_suppkey) join (select o_orderdate, o_orderkey from orders) orders on (l_orderkey = o_orderkey) join (select n_name, n_nationkey from nation) nation on (s_nationkey = n_nationkey)) profit) profits group by nation, o_year order by nation, o_year desc
