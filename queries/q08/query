select sum(CASE WHEN n2name = 'BRAZIL' THEN volume ELSE 0 END)::float / sum(volume)::float AS mkt_share, o_year from (select date_part('year', o_orderdate) as o_year, (l_extendedprice * (1 - l_discount))::float as volume , n2name from ((select p_partkey from part where p_type = 'ECONOMY ANODIZED STEEL') part join (select l_partkey, l_suppkey, l_orderkey, l_extendedprice, l_discount from lineitem) lineitem on (l_partkey = p_partkey) join (select s_suppkey, s_nationkey from supplier) supplier on (l_suppkey = s_suppkey) join (select o_custkey, o_orderkey, o_orderdate from orders where o_orderdate >= to_date('1995-01-01', 'YYYY-MM-DD') and o_orderdate <= to_date('1996-12-31', 'YYYY-MM-DD')) orders on (l_orderkey = o_orderkey) join (select c_custkey, c_nationkey from customer) customer on (c_custkey = o_custkey) join (select n_regionkey as n1regkey, n_nationkey as n1key from nation) nation on (c_nationkey = n1key) join (select n_name as n2name, n_nationkey as n2key from nation) nation2 on (n2key = s_nationkey) join (select r_regionkey from region where r_name = 'AMERICA') region on (r_regionkey = n1regkey) ) all_nations) all_nations group by o_year order by o_year
